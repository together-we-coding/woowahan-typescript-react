# 7ì¥. API ìš”ì²­ê³¼ ìƒíƒœ ê´€ë¦¬, ì—ëŸ¬ í•¸ë“¤ë§, ëª¨í‚¹

## 7.1 API ìš”ì²­

### fetchë¡œ API ìš”ì²­í•˜ê¸°
```typescript
const NotificationBadge: React.FC = () => {
  const [notificationCount, setNotificationCount] = useState(0);

  useEffect(() => {
    fetch('/api/notifications')
      .then(response => response.json())
      .then(({ notifications }) => {
        setNotificationCount(notifications.length);
      });
  }, []);
};
```
ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì§ì ‘ APIë¥¼ í˜¸ì¶œí•˜ë©´, ë°±ì—”ë“œ ë³€ê²½ ì‹œ ì½”ë“œ ìˆ˜ì •ì´ ë²ˆê±°ë¡­ìŠµë‹ˆë‹¤.

### ì„œë¹„ìŠ¤ ë ˆì´ì–´ ë¶„ë¦¬
ë¹„ë™ê¸° í˜¸ì¶œì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¶„ë¦¬í•˜ì—¬ **ì„œë¹„ìŠ¤ ë ˆì´ì–´**ì—ì„œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ì— ìœ ë¦¬í•©ë‹ˆë‹¤.

### Axios ì‚¬ìš©
- `fetch`ëŠ” ë‚´ì¥ í•¨ìˆ˜ì§€ë§Œ í™•ì¥ì„±ì— í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.
- **Axios**ëŠ” ê¸°ë³¸ ì„¤ì •, ì¸ìŠ¤í„´ìŠ¤ ë¶„ë¦¬, ì¸í„°ì…‰í„° ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ ì œê³µ

```typescript
const productApi = axios.create({ baseURL: 'https://api.shop.com', timeout: 5000 });
const orderApi = axios.create({ baseURL: 'https://api.order.shop.com', timeout: 5000 });
```

### Axios Interceptors
ìš”ì²­ì´ë‚˜ ì‘ë‹µì„ ê°€ë¡œì±„ ì¶”ê°€ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```typescript
productApi.interceptors.request.use(config => {
  config.headers['Authorization'] = `Bearer ${getAccessToken()}`;
  return config;
});

orderApi.interceptors.response.use(
  response => response,
  error => orderErrorHandler(error)
);
```

## 7.2 API ìƒíƒœê´€ë¦¬

### ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©
ì„œë¹„ìŠ¤ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ ë³€ê²½í•˜ê³  ì»´í¬ë„ŒíŠ¸ëŠ” ìƒíƒœë¥¼ êµ¬ë…í•©ë‹ˆë‹¤.

### í›…ìœ¼ë¡œ API í˜¸ì¶œ
```typescript
const useFetchProductList = () => {
  return useQuery(['fetchProductList'], async () => {
    const response = await ProductService.fetchProductList();
    return new ProductList(response);
  });
};
```

```typescript
const useUpdateProductStock = (productId: number, { onSuccess }: UseMutationOptions) => {
  const queryClient = useQueryClient();

  return useMutation(
    async (form: UpdateStockForm) => {
      await ProductService.updateStock(productId, form);
    },
    {
      onSuccess: () => {
        queryClient.invalidateQueries(['fetchProductList']);
        onSuccess?.();
      },
    }
  );
};
```

## 7.3 API ì—ëŸ¬ í•¸ë“¤ë§

### íƒ€ì… ê°€ë“œ í™œìš©
```typescript
interface ApiErrorResponse {
  code: string;
  message: string;
}

function isApiError(error: unknown): error is AxiosError<ApiErrorResponse> {
  return axios.isAxiosError(error);
}
```

### ì„œë¸Œí´ë˜ì‹± í™œìš©
```typescript
class PaymentError extends Error {
  constructor(public response?: AxiosResponse<ApiErrorResponse>) {
    super(response?.data.message);
    this.name = 'PaymentError';
  }
}
```

### ì¸í„°ì…‰í„°ë¥¼ í†µí•œ ì—ëŸ¬ ì²˜ë¦¬
```typescript
orderApi.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 403) {
      window.location.href = '/unauthorized';
    }
    return Promise.reject(error);
  }
);
```

### ì—ëŸ¬ ë°”ìš´ë”ë¦¬
```typescript
class ErrorBoundary extends React.Component {
  state = { hasError: false };

  componentDidCatch(error, info) {
    console.error(error, info);
    this.setState({ hasError: true });
  }

  render() {
    return this.state.hasError ? <FallbackPage /> : this.props.children;
  }
}
```

## 7.4 API ëª¨í‚¹

### JSON íŒŒì¼ ì‚¬ìš©
```typescript
const PRODUCTS = [
  { id: 1, name: 'Wireless Mouse' },
  { id: 2, name: 'Bluetooth Keyboard' },
];
```

### Next.js API Route í™œìš©
```typescript
const handler: NextApiHandler = (req, res) => {
  res.status(200).json(PRODUCTS);
};
export default handler;
```

### axios-mock-adapter ì‚¬ìš©
```typescript
import MockAdapter from 'axios-mock-adapter';
const mock = new MockAdapter(axios);

mock.onGet('/products').reply(200, PRODUCTS);
```

### ëª©ì—… ì‚¬ìš© ì—¬ë¶€ ì œì–´
```json
"scripts": {
  "start:mock": "REACT_APP_MOCK=true npm run start",
  "start": "REACT_APP_MOCK=false npm run start"
}
```

---

# API ìš”ì²­ê³¼ ê´€ë¦¬ ìš”ì•½í‘œ

| êµ¬ë¶„ | ë‚´ìš© |
|:---|:---|
| API ìš”ì²­ | fetch, axios í™œìš© |
| ì„œë¹„ìŠ¤ ë ˆì´ì–´ | ë¹„ë™ê¸° í˜¸ì¶œ ë¶„ë¦¬ |
| ìƒíƒœ ê´€ë¦¬ | useQuery, useMutation (react-query) |
| ì—ëŸ¬ í•¸ë“¤ë§ | íƒ€ì… ê°€ë“œ, ì„œë¸Œí´ë˜ì‹±, ì¸í„°ì…‰í„°, ì—ëŸ¬ ë°”ìš´ë”ë¦¬ |
| ëª¨í‚¹ | JSON íŒŒì¼, Next.js API Routes, axios-mock-adapter í™œìš© |


# ì „ì²´ íë¦„ë„

```plaintext
[ì»´í¬ë„ŒíŠ¸] 
    â†“ (ìš”ì²­)
[ì„œë¹„ìŠ¤ ë ˆì´ì–´]
    â†“ (Axios ì¸ìŠ¤í„´ìŠ¤)
[API ì„œë²„]
    â†“ (ì‘ë‹µ)
[Axios Interceptor]
    â†“ (ì„±ê³µ/ì—ëŸ¬ ì²˜ë¦¬)
[ìƒíƒœê´€ë¦¬ or UI ì—…ë°ì´íŠ¸]
```

---

7ì¥ì„ ì •ë¦¬í•˜ë©´ì„œ **API ìš”ì²­ì˜ íë¦„, ìƒíƒœ ê´€ë¦¬, ì—ëŸ¬ ì²˜ë¦¬, ëª¨í‚¹**ê¹Œì§€ ì „ì²´ì ì¸ ë°ì´í„° íë¦„ì„ ì²´ê³„ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆì—ˆë‹¤. íŠ¹íˆ ì„œë¹„ìŠ¤ ë ˆì´ì–´ ë¶„ë¦¬, ì¸í„°ì…‰í„°ë¥¼ í†µí•œ ì¼ê´„ ì²˜ë¦¬, ì—ëŸ¬ ì„œë¸Œí´ë˜ì‹±, ëª©ì—… ì „ëµ ë“±ì€ ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ë‚˜ í˜‘ì—… í™˜ê²½ì—ì„œë„ **ë³€ê²½ì— ìœ ì—°í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì¢‹ì€ ì½”ë“œ êµ¬ì¡°**ë¥¼ ë§Œë“œëŠ” ë° í•µì‹¬ì´ë¼ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ë‹¤.

ì˜ˆì‹œë„ ì‹¤ìƒí™œê³¼ ë°€ì ‘í•œ ë°ì´í„°(ìƒí’ˆ, ì•Œë¦¼, ì£¼ë¬¸ ë“±)ë¥¼ ë‹¤ë£¨ë©´ì„œ ì‹¤ì œ ê°œë°œ í™˜ê²½ê³¼ ë¹„ìŠ·í•œ ëŠë‚Œì„ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤. ì•ìœ¼ë¡œ ì‹¤ì œ ê°œë°œì—ì„œë„ ì´ íë¦„ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì ìš©í•˜ê³ , ë‹¤ì–‘í•œ ìƒí™©ë³„ ì˜ˆì™¸ì²˜ë¦¬ê¹Œì§€ ì‹ ê²½ì“°ëŠ” ê°œë°œìê°€ ë˜ê³  ì‹¶ë‹¤. ğŸš€

